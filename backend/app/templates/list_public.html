{% extends "base.html" %}

{% block title %}{{ list.name }} - Border Badge{% endblock %}
{% block description %}{{ list.description or 'A public travel list on Border Badge' }}{% endblock %}

{% block content %}
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "ItemList",
  "name": {{ list.name|tojson }},
  "description": {{ (list.description or '')|tojson }},
  "datePublished": {{ list.created_at.isoformat()|tojson }},
  "url": {{ canonical_url|tojson }},
  "itemListElement": [
    {% for entry in list.entries %}
    {
      "@type": "ListItem",
      "position": {{ loop.index }},
      "name": {{ entry.title|tojson }}
    }{% if not loop.last %},{% endif %}
    {% endfor %}
  ],
  "breadcrumb": {
    "@type": "BreadcrumbList",
    "itemListElement": [
      {
        "@type": "ListItem",
        "position": 1,
        "name": "Home",
        "item": {{ canonical_url.split('/l/')[0]|tojson }}
      },
      {
        "@type": "ListItem",
        "position": 2,
        "name": {{ list.name|tojson }},
        "item": {{ canonical_url|tojson }}
      }
    ]
  }
}
</script>

<!-- Hero Section -->
<section class="hero-section">
    {% if list.cover_image_url %}
    <img src="{{ list.cover_image_url }}" alt="{{ list.name }}" class="hero-bg">
    {% else %}
    <!-- Fallback pattern if no image -->
    <div class="hero-bg" style="background-color: var(--color-midnight-navy); background-image: radial-gradient(circle at 10% 20%, rgba(255,255,255,0.05) 0%, transparent 20%), radial-gradient(circle at 90% 80%, rgba(255,255,255,0.05) 0%, transparent 20%);"></div>
    {% endif %}
    <div class="hero-overlay"></div>
</section>

<!-- List Info Card (Liquid Glass) -->
<div class="list-info-container">
    <div class="list-info-card">
        <h1 class="list-title">{{ list.name }}</h1>
        
        <div class="list-meta">
            {% if list.country_name %}
            <div class="meta-item">
                <span style="font-size: 1.2em;">{{ list.country_flag or 'üåç' }}</span> {{ list.country_name }}
            </div>
            {% endif %}
            
            {% if list.trip_name %}
            <div class="meta-item">
                <span style="font-size: 1.2em;">‚úàÔ∏è</span> {{ list.trip_name }}
            </div>
            {% endif %}

            <div class="meta-item">
                <span style="font-size: 1.2em;">üìç</span> {{ list.entries|length }} Places
            </div>

            <div class="meta-item">
                <span style="font-size: 1.2em;">üìÖ</span> Shared {{ list.created_at.strftime('%B %d, %Y') }}
            </div>
        </div>

        {% if list.description %}
        <p class="list-description">{{ list.description }}</p>
        {% endif %}
    </div>
</div>

<!-- Entries Grid -->
<section class="entries-container">
    {% if list.entries %}
    <div class="entries-grid">
        {% for entry in list.entries %}
        {% set entry_url = entry.link if entry.link else ('https://www.google.com/maps/search/?api=1&query=' ~ (entry.latitude|string) ~ ',' ~ (entry.longitude|string) if entry.latitude and entry.longitude else ('https://www.google.com/maps/search/?api=1&query_place_id=' ~ entry.google_place_id if entry.google_place_id else '')) %}
        
        {% if entry_url %}
        <a href="{{ entry_url }}" target="_blank" rel="noopener noreferrer" class="entry-card-link">
        {% endif %}
            
            <article class="entry-card">
                <div class="entry-image-wrapper">
                    {% if entry.media_urls and entry.media_urls|length > 0 %}
                    <img src="{{ entry.media_urls[0] }}" alt="{{ entry.title }}" class="entry-image" loading="lazy">
                    {% else %}
                    <div class="entry-image-placeholder">
                        <span>No Photo</span>
                    </div>
                    {% endif %}
                </div>
                
                <div class="entry-content">
                    {% if entry.type %}
                    <span class="entry-category">{{ entry.type }}</span>
                    {% endif %}
                    
                    <h3 class="entry-title">{{ entry.title }}</h3>
                    
                    {% if entry.place_name %}
                    <div class="entry-location">
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path><circle cx="12" cy="10" r="3"></circle></svg>
                        {{ entry.place_name }}
                    </div>
                    {% endif %}
                    
                    {% if entry.notes %}
                    <div class="entry-notes">
                        "{{ entry.notes[:200] }}{% if entry.notes|length > 200 %}...{% endif %}"
                    </div>
                    {% endif %}
                </div>
            </article>
            
        {% if entry_url %}
        </a>
        {% endif %}
        {% endfor %}
    </div>
    {% else %}
    <div class="empty-state">
        <p>This list is just getting started. No entries yet.</p>
    </div>
    {% endif %}
</section>

<!-- CTA Section -->
<section class="cta-section">
    <div class="cta-content">
        <span class="cta-hand-text">Start your adventure</span>
        <h2 class="cta-title">Track your travels & share your story</h2>
        <p style="margin-bottom: 2rem; opacity: 0.9;">Download Border Badge to build your own lists, mark countries visited, and explore the world.</p>
        <a href="{{ app_store_url or '#download' }}" class="cta-button">
            Get Border Badge
        </a>
    </div>
</section>
{% endblock %}

{% block footer_cta %}{% endblock %}
